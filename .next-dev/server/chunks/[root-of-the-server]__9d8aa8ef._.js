module.exports = {

"[project]/.next-internal/server/app/api/upload/route/actions.js [app-rsc] (server actions loader, ecmascript)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
}}),
"[externals]/next/dist/compiled/next-server/app-route-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-route-turbo.runtime.dev.js, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js"));

module.exports = mod;
}}),
"[externals]/next/dist/compiled/@opentelemetry/api [external] (next/dist/compiled/@opentelemetry/api, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/compiled/@opentelemetry/api", () => require("next/dist/compiled/@opentelemetry/api"));

module.exports = mod;
}}),
"[externals]/next/dist/compiled/next-server/app-page-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-page-turbo.runtime.dev.js, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js"));

module.exports = mod;
}}),
"[externals]/next/dist/server/app-render/work-unit-async-storage.external.js [external] (next/dist/server/app-render/work-unit-async-storage.external.js, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/server/app-render/work-unit-async-storage.external.js", () => require("next/dist/server/app-render/work-unit-async-storage.external.js"));

module.exports = mod;
}}),
"[externals]/next/dist/server/app-render/work-async-storage.external.js [external] (next/dist/server/app-render/work-async-storage.external.js, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/server/app-render/work-async-storage.external.js", () => require("next/dist/server/app-render/work-async-storage.external.js"));

module.exports = mod;
}}),
"[externals]/next/dist/server/app-render/after-task-async-storage.external.js [external] (next/dist/server/app-render/after-task-async-storage.external.js, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/server/app-render/after-task-async-storage.external.js", () => require("next/dist/server/app-render/after-task-async-storage.external.js"));

module.exports = mod;
}}),
"[externals]/crypto [external] (crypto, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("crypto", () => require("crypto"));

module.exports = mod;
}}),
"[externals]/querystring [external] (querystring, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("querystring", () => require("querystring"));

module.exports = mod;
}}),
"[externals]/url [external] (url, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("url", () => require("url"));

module.exports = mod;
}}),
"[externals]/fs [external] (fs, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("fs", () => require("fs"));

module.exports = mod;
}}),
"[externals]/path [external] (path, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("path", () => require("path"));

module.exports = mod;
}}),
"[externals]/https [external] (https, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("https", () => require("https"));

module.exports = mod;
}}),
"[externals]/http [external] (http, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("http", () => require("http"));

module.exports = mod;
}}),
"[externals]/stream [external] (stream, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("stream", () => require("stream"));

module.exports = mod;
}}),
"[project]/src/lib/cloudinary.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
__turbopack_context__.s({
    "default": (()=>__TURBOPACK__default__export__),
    "deleteFromCloudinary": (()=>deleteFromCloudinary),
    "extractPublicIdFromUrl": (()=>extractPublicIdFromUrl),
    "getImageSrcSet": (()=>getImageSrcSet),
    "getOptimizedImageUrl": (()=>getOptimizedImageUrl),
    "getOptimizedVideoUrl": (()=>getOptimizedVideoUrl),
    "getResponsiveImageUrl": (()=>getResponsiveImageUrl),
    "getVideoThumbnail": (()=>getVideoThumbnail),
    "isCloudinaryUrl": (()=>isCloudinaryUrl),
    "uploadToCloudinary": (()=>uploadToCloudinary)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$cloudinary$2f$cloudinary$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/cloudinary/cloudinary.js [app-route] (ecmascript)");
;
// تكوين Cloudinary
const isCloudinaryConfigured = Boolean(process.env.CLOUDINARY_CLOUD_NAME && process.env.CLOUDINARY_API_KEY && process.env.CLOUDINARY_API_SECRET && process.env.CLOUDINARY_CLOUD_NAME !== 'demo');
if (isCloudinaryConfigured) {
    __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$cloudinary$2f$cloudinary$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["v2"].config({
        cloud_name: process.env.CLOUDINARY_CLOUD_NAME,
        api_key: process.env.CLOUDINARY_API_KEY,
        api_secret: process.env.CLOUDINARY_API_SECRET
    });
    console.log('✅ Cloudinary configured successfully with cloud:', process.env.CLOUDINARY_CLOUD_NAME);
} else {
    console.log('⚠️ Cloudinary not configured. Using local fallback mode.');
    console.log('📋 Environment variables status:', {
        cloud_name: process.env.CLOUDINARY_CLOUD_NAME || 'missing',
        api_key: process.env.CLOUDINARY_API_KEY ? 'configured' : 'missing',
        api_secret: process.env.CLOUDINARY_API_SECRET ? 'configured' : 'missing'
    });
}
async function uploadToCloudinary(file, options = {}) {
    // التحقق من إعداد Cloudinary
    if (!isCloudinaryConfigured) {
        throw new Error('Cloudinary غير مُعَدّ. يرجى إضافة بيانات الاعتماد في ملف .env');
    }
    try {
        // التحقق من صحة الملف أولاً
        if (!file || file.size === 0) {
            throw new Error('الملف فارغ أو غير صالح');
        }
        // تحويل File إلى Buffer مع معالجة الأخطاء
        let buffer;
        try {
            const bytes = await file.arrayBuffer();
            buffer = Buffer.from(bytes);
            if (buffer.length === 0) {
                throw new Error('فشل في قراءة محتوى الملف');
            }
        } catch (error) {
            throw new Error(`فشل في معالجة الملف: ${error instanceof Error ? error.message : 'خطأ غير معروف'}`);
        }
        // تحديد نوع الملف مع فحص أعمق
        const isVideo1 = file.type.startsWith('video/');
        const isImage = file.type.startsWith('image/');
        if (!isVideo1 && !isImage) {
            throw new Error(`نوع الملف غير مدعوم: ${file.type}`);
        }
        const defaultOptions = {
            folder: options.folder || 'portfolio',
            resource_type: options.resource_type || (isVideo1 ? 'video' : isImage ? 'image' : 'auto'),
            public_id: options.public_id,
            // تحسينات مخصصة حسب نوع الملف
            transformation: options.transformation || (isVideo1 ? {
                // إعدادات أساسية للفيديو
                quality: 'auto',
                width: 1280,
                height: 720,
                crop: 'limit',
                bit_rate: '1m'
            } : {
                // تحسينات للصور
                quality: 'auto',
                fetch_format: 'auto',
                flags: 'progressive'
            }),
            // إعدادات إضافية
            overwrite: true,
            invalidate: true,
            // إعدادات خاصة بالفيديو
            ...isVideo1 && {
                chunk_size: 6000000,
                timeout: 120000
            },
            ...options
        };
        console.log('🚀 رفع ملف إلى Cloudinary:', {
            name: file.name,
            type: file.type,
            size: file.size,
            folder: defaultOptions.folder,
            resource_type: defaultOptions.resource_type,
            sizeInMB: (file.size / 1024 / 1024).toFixed(2) + 'MB'
        });
        // رفع الملف
        const result = await new Promise((resolve, reject)=>{
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$cloudinary$2f$cloudinary$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["v2"].uploader.upload_stream(defaultOptions, (error, result)=>{
                if (error) {
                    console.error('❌ خطأ في رفع Cloudinary:', error);
                    reject(error);
                } else if (result) {
                    console.log('✅ تم رفع الملف بنجاح:', {
                        url: result.secure_url,
                        public_id: result.public_id,
                        resource_type: result.resource_type,
                        bytes: result.bytes
                    });
                    // التحقق من صحة النتيجة
                    if (!result.secure_url) {
                        reject(new Error('لم يتم إرجاع رابط آمن من Cloudinary'));
                        return;
                    }
                    resolve(result);
                } else {
                    reject(new Error('لم يتم إرجاع نتيجة من Cloudinary'));
                }
            }).end(buffer);
        });
        return result;
    } catch (error) {
        console.error('❌ خطأ في رفع الملف:', error);
        // رسائل خطأ مخصصة حسب نوع الخطأ
        let errorMessage = 'خطأ غير معروف';
        if (error instanceof Error) {
            if (error.message.includes('Invalid cloud_name')) {
                errorMessage = 'اسم Cloud غير صحيح في إعدادات Cloudinary';
            } else if (error.message.includes('Invalid API key')) {
                errorMessage = 'API Key غير صحيح في إعدادات Cloudinary';
            } else if (error.message.includes('file size')) {
                errorMessage = 'حجم الملف كبير جداً. الحد الأقصى للفيديو 100MB';
            } else if (error.message.includes('timeout')) {
                errorMessage = 'انتهت مهلة رفع الملف. جرب ملف أصغر';
            } else if (isVideo && error.message.includes('resource_type')) {
                errorMessage = 'نوع الفيديو غير مدعوم. جرب MP4';
            } else {
                errorMessage = error.message;
            }
        }
        throw new Error(`فشل في رفع الملف: ${errorMessage}`);
    }
}
async function deleteFromCloudinary(publicId, resourceType = 'image') {
    try {
        console.log('🗑️ حذف ملف من Cloudinary:', publicId);
        const result = await __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$cloudinary$2f$cloudinary$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["v2"].uploader.destroy(publicId, {
            resource_type: resourceType,
            invalidate: true
        });
        console.log('✅ تم حذف الملف:', result);
        return result;
    } catch (error) {
        console.error('❌ خطأ في حذف الملف:', error);
        throw error;
    }
}
function getOptimizedImageUrl(publicId, options = {}) {
    return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$cloudinary$2f$cloudinary$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["v2"].url(publicId, {
        quality: options.quality || 'auto',
        fetch_format: options.format || 'auto',
        width: options.width,
        height: options.height,
        crop: options.crop || 'fill',
        flags: 'progressive',
        ...options
    });
}
function getOptimizedVideoUrl(publicId, options = {}) {
    return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$cloudinary$2f$cloudinary$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["v2"].url(publicId, {
        resource_type: 'video',
        quality: options.quality || 'auto',
        fetch_format: options.format || 'auto',
        width: options.width,
        height: options.height,
        ...options
    });
}
function getVideoThumbnail(publicId, options = {}) {
    return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$cloudinary$2f$cloudinary$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["v2"].url(publicId, {
        resource_type: 'video',
        format: 'jpg',
        quality: 'auto',
        width: options.width || 300,
        height: options.height || 200,
        crop: 'fill',
        start_offset: options.start_offset || '0',
        ...options
    });
}
function getResponsiveImageUrl(publicId, usage = 'card') {
    const configs = {
        thumbnail: {
            width: 150,
            height: 150,
            crop: 'thumb',
            gravity: 'face'
        },
        card: {
            width: 400,
            height: 300,
            crop: 'fill'
        },
        hero: {
            width: 1200,
            height: 600,
            crop: 'fill'
        },
        gallery: {
            width: 800,
            height: 600,
            crop: 'fill'
        }
    };
    const config = configs[usage];
    return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$cloudinary$2f$cloudinary$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["v2"].url(publicId, {
        ...config,
        quality: 'auto',
        fetch_format: 'auto',
        flags: 'progressive',
        dpr: 'auto'
    });
}
function getImageSrcSet(publicId) {
    const sizes = [
        320,
        640,
        768,
        1024,
        1280,
        1920
    ];
    return sizes.map((size)=>{
        const url = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$cloudinary$2f$cloudinary$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["v2"].url(publicId, {
            width: size,
            quality: 'auto',
            fetch_format: 'auto',
            flags: 'progressive'
        });
        return `${url} ${size}w`;
    }).join(', ');
}
function isCloudinaryUrl(url) {
    return url.includes('cloudinary.com') || url.includes('res.cloudinary.com');
}
function extractPublicIdFromUrl(url) {
    if (!isCloudinaryUrl(url)) return null;
    const matches = url.match(/\/(?:image|video)\/upload\/(?:v\d+\/)?(.+?)(?:\.|$)/);
    return matches ? matches[1].split('.')[0] : null;
}
const __TURBOPACK__default__export__ = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$cloudinary$2f$cloudinary$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["v2"];
}}),
"[externals]/fs/promises [external] (fs/promises, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("fs/promises", () => require("fs/promises"));

module.exports = mod;
}}),
"[project]/src/app/api/upload/route.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
__turbopack_context__.s({
    "POST": (()=>POST)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/server.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$cloudinary$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/cloudinary.ts [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$externals$5d2f$fs$2f$promises__$5b$external$5d$__$28$fs$2f$promises$2c$__cjs$29$__ = __turbopack_context__.i("[externals]/fs/promises [external] (fs/promises, cjs)");
var __TURBOPACK__imported__module__$5b$externals$5d2f$fs__$5b$external$5d$__$28$fs$2c$__cjs$29$__ = __turbopack_context__.i("[externals]/fs [external] (fs, cjs)");
var __TURBOPACK__imported__module__$5b$externals$5d2f$path__$5b$external$5d$__$28$path$2c$__cjs$29$__ = __turbopack_context__.i("[externals]/path [external] (path, cjs)");
;
;
;
;
;
// التحقق من توفر إعدادات Cloudinary
const isCloudinaryAvailable = Boolean(process.env.CLOUDINARY_CLOUD_NAME && process.env.CLOUDINARY_API_KEY && process.env.CLOUDINARY_API_SECRET && process.env.CLOUDINARY_CLOUD_NAME !== 'demo');
// دالة لتحسين أسماء الملفات لـ SEO
function generateSEOFriendlyName(originalName) {
    const nameWithoutExt = originalName.replace(/\.[^/.]+$/, '');
    return nameWithoutExt.toLowerCase().replace(/[\s_]+/g, '-') // استبدال المسافات بـ -
    .replace(/[^\w\u0600-\u06FF-]/g, '') // الحفاظ على الأحرف العربية والإنجليزية فقط
    .replace(/-+/g, '-') // إزالة الشرطات المتكررة
    .replace(/^-|-$/g, '') // إزالة الشرطات من البداية والنهاية
    .substring(0, 50) || 'aldeyar-project'; // تحديد الطول
}
// إعدادات محسنة للرفع
const UPLOAD_CONFIG = {
    maxFileSize: isCloudinaryAvailable ? 100 * 1024 * 1024 : 50 * 1024 * 1024,
    maxFiles: 20,
    allowedImageTypes: [
        'image/jpeg',
        'image/jpg',
        'image/png',
        'image/webp',
        'image/gif',
        'image/bmp',
        'image/tiff'
    ],
    allowedVideoTypes: [
        'video/mp4',
        'video/mov',
        'video/avi',
        'video/webm',
        'video/quicktime',
        'video/x-msvideo',
        'video/mkv'
    ],
    compressionQuality: {
        image: {
            quality: 85,
            width: 1920,
            height: 1080
        },
        video: {
            quality: 'auto',
            width: 1280,
            height: 720
        }
    }
};
async function POST(request) {
    try {
        const formData = await request.formData();
        // دعم رفع ملف واحد أو عدة ملفات
        const files = formData.getAll('files');
        const singleFile = formData.get('file');
        console.log('📤 محاولة رفع ملف:', {
            singleFile: !!singleFile,
            singleFileName: singleFile?.name,
            singleFileType: singleFile?.type,
            singleFileSize: singleFile?.size,
            multipleFiles: files.length,
            cloudinaryAvailable: isCloudinaryAvailable
        });
        let filesToProcess = [];
        if (singleFile && singleFile.size > 0) {
            filesToProcess = [
                singleFile
            ];
        } else if (files && files.length > 0) {
            // تصفية الملفات الفارغة
            filesToProcess = files.filter((file)=>file && file.size > 0);
        }
        if (filesToProcess.length === 0) {
            console.log('❌ لم يتم تحديد أي ملفات');
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: 'لم يتم تحديد أي ملفات'
            }, {
                status: 400
            });
        }
        const uploadedFiles = [];
        // إعداد التخزين المحلي كـ fallback
        let uploadDir = '';
        if (!isCloudinaryAvailable) {
            uploadDir = __TURBOPACK__imported__module__$5b$externals$5d2f$path__$5b$external$5d$__$28$path$2c$__cjs$29$__["default"].join(process.cwd(), 'public', 'uploads');
            if (!(0, __TURBOPACK__imported__module__$5b$externals$5d2f$fs__$5b$external$5d$__$28$fs$2c$__cjs$29$__["existsSync"])(uploadDir)) {
                await (0, __TURBOPACK__imported__module__$5b$externals$5d2f$fs$2f$promises__$5b$external$5d$__$28$fs$2f$promises$2c$__cjs$29$__["mkdir"])(uploadDir, {
                    recursive: true
                });
                console.log('📁 تم إنشاء مجلد uploads (fallback mode)');
            }
        }
        for (const file of filesToProcess){
            if (!file || file.size === 0) {
                console.log('⚠️ تجاهل ملف فارغ');
                continue;
            }
            console.log('🔍 معالجة ملف:', {
                name: file.name,
                type: file.type,
                size: file.size
            });
            // التحقق من نوع الملف مع دعم أفضل
            const isImage = UPLOAD_CONFIG.allowedImageTypes.includes(file.type);
            const isVideo = UPLOAD_CONFIG.allowedVideoTypes.includes(file.type);
            if (!isImage && !isVideo) {
                console.log('❌ نوع ملف غير مدعوم:', file.type);
                uploadedFiles.push({
                    originalName: file.name,
                    error: `نوع الملف ${file.type} غير مدعوم`,
                    type: 'ERROR'
                });
                continue;
            }
            // التحقق من حجم الملف مع رسائل مفصلة
            if (file.size > UPLOAD_CONFIG.maxFileSize) {
                const maxSizeMB = (UPLOAD_CONFIG.maxFileSize / 1024 / 1024).toFixed(0);
                const fileSizeMB = (file.size / 1024 / 1024).toFixed(1);
                console.log(`❌ ملف كبير جداً: ${fileSizeMB}MB > ${maxSizeMB}MB`);
                uploadedFiles.push({
                    originalName: file.name,
                    error: `حجم الملف ${fileSizeMB}MB يتجاوز الحد الأقصى ${maxSizeMB}MB`,
                    type: 'ERROR'
                });
                continue;
            }
            // التحقق من امتداد الملف للأمان
            const fileExtension = __TURBOPACK__imported__module__$5b$externals$5d2f$path__$5b$external$5d$__$28$path$2c$__cjs$29$__["default"].extname(file.name).toLowerCase();
            const validImageExts = [
                '.jpg',
                '.jpeg',
                '.png',
                '.webp',
                '.gif',
                '.bmp',
                '.tiff'
            ];
            const validVideoExts = [
                '.mp4',
                '.mov',
                '.avi',
                '.webm',
                '.mkv'
            ];
            if (isImage && !validImageExts.includes(fileExtension)) {
                uploadedFiles.push({
                    originalName: file.name,
                    error: `امتداد الملف ${fileExtension} لا يتطابق مع نوع الصورة`,
                    type: 'ERROR'
                });
                continue;
            }
            if (isVideo && !validVideoExts.includes(fileExtension)) {
                uploadedFiles.push({
                    originalName: file.name,
                    error: `امتداد الملف ${fileExtension} لا يتطابق مع نوع الفيديو`,
                    type: 'ERROR'
                });
                continue;
            }
            try {
                let uploadedFile;
                if (isCloudinaryAvailable) {
                    // رفع إلى Cloudinary مع إعدادات محسنة
                    console.log('☁️ رفع إلى Cloudinary...');
                    // تحسين أسماء الملفات لـ SEO
                    const seoFriendlyName = generateSEOFriendlyName(file.name);
                    const cloudinaryOptions = {
                        folder: 'portfolio/projects',
                        resource_type: isVideo ? 'video' : 'image',
                        public_id: `${Date.now()}-${seoFriendlyName}`,
                        use_filename: false,
                        unique_filename: true,
                        overwrite: false,
                        // إضافة metadata للSEO
                        context: {
                            alt: `محترفين الديار العالمية - ${seoFriendlyName}`,
                            caption: `مشروع من محترفين الديار العالمية في جدة`,
                            title: seoFriendlyName
                        },
                        // تحسين خصائص الملفات للويب
                        transformation: isVideo ? {
                            // إعدادات أساسية للفيديو فقط
                            quality: 'auto',
                            width: 1280,
                            height: 720,
                            crop: 'limit'
                        } : {
                            // تحسين للصور
                            quality: 'auto',
                            format: 'webp',
                            width: 'auto',
                            crop: 'scale',
                            dpr: 'auto',
                            flags: 'progressive'
                        },
                        // إعدادات إضافية للأمان والأداء
                        invalidate: true,
                        overwrite: true,
                        unique_filename: true,
                        use_filename: false
                    };
                    const result = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$cloudinary$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["uploadToCloudinary"])(file, cloudinaryOptions);
                    console.log('✅ تم رفع الملف إلى Cloudinary:', result.secure_url);
                    uploadedFile = {
                        originalName: file.name,
                        fileName: result.public_id,
                        src: result.secure_url,
                        url: result.secure_url,
                        type: file.type.startsWith('video/') ? 'VIDEO' : 'IMAGE',
                        size: result.bytes,
                        mimeType: file.type,
                        width: result.width || null,
                        height: result.height || null,
                        duration: result.duration || null,
                        cloudinary_public_id: result.public_id,
                        cloudinary_url: result.secure_url,
                        resource_type: result.resource_type,
                        storage_type: 'cloudinary'
                    };
                    // التحقق من صحة النتيجة
                    if (!uploadedFile.src) {
                        throw new Error('لم يتم الحصول على رابط صحيح من Cloudinary');
                    }
                } else {
                    // رفع محلي (fallback)
                    console.log('💾 رفع محلي (fallback mode)...');
                    const timestamp = Date.now();
                    const randomString = Math.random().toString(36).substring(2, 15);
                    const fileExtension = __TURBOPACK__imported__module__$5b$externals$5d2f$path__$5b$external$5d$__$28$path$2c$__cjs$29$__["default"].extname(file.name);
                    const fileName = `${timestamp}_${randomString}${fileExtension}`;
                    const filePath = __TURBOPACK__imported__module__$5b$externals$5d2f$path__$5b$external$5d$__$28$path$2c$__cjs$29$__["default"].join(uploadDir, fileName);
                    const bytes = await file.arrayBuffer();
                    const buffer = Buffer.from(bytes);
                    await (0, __TURBOPACK__imported__module__$5b$externals$5d2f$fs$2f$promises__$5b$external$5d$__$28$fs$2f$promises$2c$__cjs$29$__["writeFile"])(filePath, buffer);
                    console.log('✅ تم حفظ الملف محلياً:', fileName);
                    uploadedFile = {
                        originalName: file.name,
                        fileName: fileName,
                        src: `/uploads/${fileName}`,
                        url: `/uploads/${fileName}`,
                        type: file.type.startsWith('video/') ? 'VIDEO' : 'IMAGE',
                        size: file.size,
                        mimeType: file.type,
                        storage_type: 'local'
                    };
                }
                uploadedFiles.push(uploadedFile);
            } catch (uploadError) {
                console.error('❌ خطأ في رفع الملف:', uploadError);
                uploadedFiles.push({
                    originalName: file.name,
                    error: `فشل في رفع ${file.name}: ${uploadError instanceof Error ? uploadError.message : 'خطأ غير معروف'}`,
                    type: 'ERROR'
                });
            }
        }
        if (uploadedFiles.length === 0) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: 'لم يتم رفع أي ملفات بنجاح'
            }, {
                status: 400
            });
        }
        // فصل الملفات الناجحة عن الخاطئة
        const successfulFiles = uploadedFiles.filter((file)=>file.type !== 'ERROR');
        const failedFiles = uploadedFiles.filter((file)=>file.type === 'ERROR');
        console.log('📊 نتيجة الرفع:', {
            successful: successfulFiles.length,
            failed: failedFiles.length,
            total: uploadedFiles.length,
            storageType: isCloudinaryAvailable ? 'cloudinary' : 'local'
        });
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            success: true,
            message: `تم رفع ${successfulFiles.length} ملف بنجاح${failedFiles.length > 0 ? ` و فشل ${failedFiles.length} ملف` : ''}`,
            files: successfulFiles,
            errors: failedFiles.length > 0 ? failedFiles : undefined,
            count: successfulFiles.length,
            storage_type: isCloudinaryAvailable ? 'cloudinary' : 'local'
        });
    } catch (error) {
        console.error('❌ خطأ عام في رفع الملفات:', error);
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            error: 'حدث خطأ في رفع الملفات',
            details: error instanceof Error ? error.message : 'خطأ غير معروف'
        }, {
            status: 500
        });
    }
}
}}),

};

//# sourceMappingURL=%5Broot-of-the-server%5D__9d8aa8ef._.js.map